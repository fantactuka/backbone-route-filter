(function(t,e){var r=t.Router.extend;t.Router.extend=function(){var t=r.apply(this,arguments),o=t.prototype,i=this.prototype;return e.each(["before","after"],function(t){e.defaults(o[t],i[t])}),t},e.extend(t.Router.prototype,{route:function(r,o,i){e.isRegExp(r)||(r=this._routeToRegExp(r)),e.isFunction(o)&&(i=o,o=""),i||(i=this[o]);var n=this;return t.history.route(r,function(e){var u=n._extractParameters(r,e);n._runFilters(n.before,e,u,!0)&&(i&&i.apply(n,u),n.trigger.apply(n,["route:"+o].concat(u)),n.trigger("route",o,u),t.history.trigger("route",n,o,u),n._runFilters(n.after,e,u,!1))}),this},_runFilters:function(t,r,o,i){return e[i?"every":"each"](t||[],function(t,i){return i=e.isRegExp(i)?i:this._routeToRegExp(i),i.test(r)?(t=e.isFunction(t)?t:this[t],t.apply(this,[r,o])!==!1):!0},this)}})})(Backbone,_);
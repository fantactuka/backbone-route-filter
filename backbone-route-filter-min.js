!function(a){"function"==typeof define&&define.amd?define(["backbone","underscore"],a):"object"==typeof exports?module.exports=a(require("backbone"),require("underscore")):a(window.Backbone,window._)}(function(a,b){function c(a,c,e,f,g){d(b.filter(c,function(c,d){return d=b.isRegExp(d)?d:a._routeToRegExp(d),d.test(e)}),a,e,f,g)}function d(a,c,e,f,g){if(!a.length)return void g.call(c);var h=a[0],i=b.tail(a),j=function(){d(i,c,e,f,g)};b.isString(h)&&(h=c[h]),3===h.length?h.apply(c,[e,f,j]):h.apply(c,[e,f])!==!1&&j()}var e=a.Router.extend;a.Router.extend=function(){var a=e.apply(this,arguments),c=a.prototype,d=this.prototype;return b.each(["before","after"],function(a){b.defaults(c[a],d[a])}),a},b.extend(a.Router.prototype,{route:function(d,e,f){b.isRegExp(d)||(d=this._routeToRegExp(d)),b.isFunction(e)&&(f=e,e=""),f||(f=this[e]);var g=this;return a.history.route(d,function(h){var i=g._extractParameters(d,h);c(g,g.before,h,i,function(){g.execute(f,i,e)!==!1&&(g.trigger.apply(g,["route:"+e].concat(i)),g.trigger("route",e,i),a.history.trigger("route",g,e,i),c(g,g.after,h,i,b.identity))})}),this}})});
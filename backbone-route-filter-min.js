(function(t,e){function r(t,r,o,i,u){var a=e.filter(r,function(r,n){return n=e.isRegExp(n)?n:t._routeToRegExp(n),n.test(o)});n(a,t,o,i,u)}function n(t,r,o,i,u){if(!t.length)return u.call(r),void 0;var a=t[0],p=e.tail(t),c=function(){n(p,r,o,i,u)};e.isString(a)&&(a=r[a]),3===a.length?a.apply(r,[o,i,c]):a.apply(r,[o,i])!==!1&&c()}var o=t.Router.extend;t.Router.extend=function(){var t=o.apply(this,arguments),r=t.prototype,n=this.prototype;return e.each(["before","after"],function(t){e.defaults(r[t],n[t])}),t},e.extend(t.Router.prototype,{route:function(n,o,i){e.isRegExp(n)||(n=this._routeToRegExp(n)),e.isFunction(o)&&(i=o,o=""),i||(i=this[o]);var u=this;return t.history.route(n,function(e){var a=u._extractParameters(n,e);r(u,u.before,e,a,function(){i&&i.apply(u,a),u.trigger.apply(u,["route:"+o].concat(a)),u.trigger("route",o,a),t.history.trigger("route",u,o,a),r(u,u.after,e,a,function(){})})}),this}})})(Backbone,_);